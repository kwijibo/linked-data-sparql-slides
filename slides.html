<!DOCTYPE html>

<meta charset="utf-8">
<title>Linked Data and SPARQL</title>

<!-- Your Slides -->
<!-- One section is one slide -->

<section>
    <!-- This is the first slide -->
    <h1>Linked Data and SPARQL</h1>
    <footer> 
    Keith Alexander <br>
    </footer>
</section>

<section>
<figure>
  <img alt="Everything is Connected. The point is to know it and to understand it." src="images/everythingisconnected.jpg">
  <figcaption>
   </figcaption>
</figure>
<p>   Â© Gillian Wearing, courtesy Maureen Paley/ Interim Art, London</p>

</section>

<section>
<figure>
  <img alt="17th Century Travel Diary" src="images/travel-diary.jpg">
</figure>
<details>
  This is a travel diary
  
  Some interested in binding, paper, materials
  Some in the collection of books it was found in
  Some in the genre of travel diaries
  Some in the author
  Some in places, people, topics, events, prices mentioned

</details>
</section>

<section>
  <h3>We are interested in things because of how they relate to other things.</h3>
  <h3>Relationships are <em>Links</em> between things</h3>
</section>

<section>
  <h3>Links make data reusable</h3>
    <ul>
      <li>Discoverable in different contexts
      <li>Useful in different contexts
      <li>More valuable
    </ul>

</section>

<section>
  <figure>
    <img alt="connections create routes for discovery" src="images/relfinder.png">
  </figure>
</section>

<section>
  <h3> Metcalfe's Law</h3>
  <figure>
    <img alt="Metcalfe's Law" src="images/Network_effect.png" style="height:auto">
  </figure>
</section>

<section>
  <h3>How to create a system for Data that:</h3>
  <ul>
    <li>Machines can read
    <li>Can describe different kinds of things and how they are connected
    <li>is easy to share and combine
  </ul>
</section>

<section>
  <h3>Technical Solution: RDF</h3>
  <ul>
    <li><q>Graph based</q> data structure
    <li>Designed for being published on the Web
  </ul>
</section>

<section>
  <h3>Graph Data Structure</h3>
  <figure>
    <img alt="a graph data structure is a web of connected Things and Text (literals)" src="images/triplestore-data-graph.png">
  </figure>
  <details>
  <p>A graph data structure is a web of connected Things and Text ('literals')</p>
  <p>
    People like graphs because they find them easy and intuitive to understand, compared to relational database tables
  </p>
    <p>
    Graphs make clear how things are connected
    </p>
  </details>

</section>

<section>
 <figure>
   <img alt="Hamlet -author-> Shakespeare -name-> William Shakespeare" src="images/hamlet-triple.002.jpg">
</figure>
<details>
  RDF consists of statements, called triples
  Triples are three part statements, Resource Property Value
</details>
</section>

<section>
<h4>Resource, Property, Value </h4>
<dl>
  <dt>Resource</dt>
  <dd><em>Things</em> - books, topics, people, places</dd>
  <dd>Identified by URIs</dd>

  <dt>Property</dt>
  <dd>Relationship (a link) to another <em>Thing</em>, or to a <em>Text Value</em>
  <dd>also identified by URI (so you can look up their meaning)</dd>

  <dt>Value</dt>
  <dd>
  can be either:
  <strong>Text</strong> ('Literals') or </dd>
  <dd> 
  URIs identifying <strong>Things</strong> ('Resources')
  </dd>
</dl>
  <details> </details>
</section>

<section>
  <h3>RDF and the Web</h3>
  <ul>
    <li>The Web is where the world shares information
    <li>Decentralised
    <li>Publish anything, link to anything
  </ul>
  <details>
    Advantages of using the web as a data system.
    (Disadvantages include, the web can be slow, and fragmented and inconsistent)
  </details>
</section>


<section>
<h3>Web Identifiers: HTTP URIs</h3>
  <p> <samp>http://example.org/Oslo</samp></p>
  <details>
    a data system needs to give things keys / unique identifiers <br>
    the web has http URIs<br>
    ties together identity with information retrieval<br>
  </details>
</section>

<section>
    <h4>Linked Data Design (Tim Berners-Lee)</h4>
    <ol class="incremental">
      <li>
          Use <small>URI</small>s as names for things
      </li>
      <li>
          Use <small>HTTP</small> <small>URI</small>s so that
          people can look up those names.
      </li>
      <li>
          When someone looks up a <small>URI</small>, provide
          useful information, using the standards (RDF*, SPARQL)
      </li>
      <li>
          Include links to other <small>URIs</small>. so that they
          can discover more things.
      </li>
    </ol>
    <details>
    This is how the web is used as a data system
    </details>
</section>



<section>
<h5>Identified by URIs</h5>

<figure>
  <img alt="" src="images/worldcat-hamlet.png">
</figure>
  <p><a href="http://www.worldcat.org/title/hamlet/oclc/7837834">Hamlet in WorldCat</a></p>
  <details> </details>
</section>


<section>
  <figure>
     <img alt="screenshot of bbc wildlife" src="images/bbc-wildlife.png">
  </figure>
  <p>
  <a href="http://www.bbc.co.uk/nature/life/Canis">Wolves on BBC Wildlife</a>
  </p>
  <details>  How RDF data can also look </details>
</section>

<section>
  <h4>Linked Data Publication Pattern</h4>
    <ul class="incremental">
      <li>A page for each <em>Thing</em> in your data.
      <li>Looking up a Thing's URI takes you to the page
      <li>Increases search engine discoverability
    </ul>
    <details> 
      Wikipedia has a page for each notable thing. 
      People will link to the page when they talk about the thing.
      Wikipedia top of search results
    </details> 
</section>

<section>
  <h3>Vocabularies</h3>
  <figure>
    <img alt="" src="images/worldcat-hamlet.png">
  </figure>
      <p><a href="http://www.worldcat.org/title/hamlet/oclc/7837834">Hamlet in WorldCat</a></p>
      <details>
      Back to Hamlet,
      Vocabularies used to describe Hamlet 1982:
      schema.org 
      rdf
      MADS/RDF
      </details>
</section>

<section>
  <h4>
    Schema.org
  </h4>
<figure>
  <img alt="" src="images/schemaorg.png">
  </figure>

 <details>
 <p>
 Google and the other search engines got together 
 to create a vocabulary for web authors to annotate their web pages with.
 </p>
<p>
It contains terms for lots of things that people commonly describe on web pages:
</p>

<ul>
  <li>Books
  <li>Films
  <li>People
  <li>Events
</ul>

<p>
Existing vocabularies already covered many of these things, 
but Google et al wanted to make it easy for web authors to markup their web pages
by only needing one vocabulary for everything.
</p>

 </details>
</section>

<section>
   <figure>
    <img alt="" src="images/xkcd-standards.png">
  </figure>
  <p>
    <a href="http://xkcd.com/927/">XKCD</a>
    </p>
    <details>
    
    </details>

</section>

<section>
<figure>
  <figcaption>Knowledge Graph</figcaption>
  <img alt="" src="images/knowledgegraph.png">
</figure>
    <details>
    <p>
    A motivation for schema.org and structured data for search engines is to turn
    <q>Strings into Things</q>.    
    They realised they can provide better searches by identifying what your search is <em>about</em> 
    rather than simply which pages the search text occurs in.
    </p>
    </details>
</section>

<section> 
  <h4>Popular Vocabularies</h4>
  <ul class="incremental">
      <li> <a href="http://purl.org/dc/terms/">Dublin Core (dc)</a>: title, modified, created, creator, publisher
      <li> <a href="http://xmlns.com/foaf/0.1/">Friend of a Friend (foaf)</a> Person, Document, Organization, topic, primaryTopic, name
      <li> <a href="http://purl.org/ontology/bibo/">Biblio Ontology (bibo)</a> Book, Chapter, Manuscript, isbn, numPages
      <li> <a href="http://www.w3.org/2002/07/owl#">Web Ontology Language (owl)</a> Class, DataProperty, ObjectProperty, sameAs
  </ul>
</section>

<section>
<h4>Finding Vocabularies</h4>
   <figure>
    <img alt="" src="images/vocab-search.png">
  </figure>
  <p>
    <a href="http://lov.okfn.org/dataset/lov/">Linked Open Vocabularies</a>
  </p>
</section>

<section>
  <h3> Consuming RDF</h3>
  <details> 
    When it's published, how do people use it?
  </details>
</section>

<section>
  <h3> Follow-your-nose Browsing </h3>
  <figure>
    <img alt="linksailor screenshot" src="images/linksailor-twain.png">
  </figure>

</section>

<section>
<h4>Strengths of <q>Follow Your Nose</q> information retrieval</h4>
  <ul>
    <li> Doesn't require background knowledge
    <li>  - just keep following links until you have enough information
    <li> Not limited to a single source of information
  </ul>
  <details>
  Linked Data is simple, RESTful and doesn't require out-of-band knowledge<br>
  Have an HTTP URI<br>
  Send an HTTP GET request to the URI<br>
  Receive machine-readable data<br> 
  </details>
</section>


<section>
  <h4>Consuming Data by <q>Follow Your Nose</q> : Limitations &amp; Challenges</h4>
  <ul>
    <li> Need a starting point
    <li> Slow - many HTTP requests to gather information
    <li> Inefficient (request a big page just to get one or two values)
  </ul>
</section>



<section>
<h2>SPARQL</h2>
<details>
  <p>
  SPARQL is a query language and protocol for RDF data.
  </p>
  <p>
  If you put a bunch of RDF data into a <em>triple store</em> (a database for RDF), 
  you can use SPARQL to query it.
    </p>
    <p>
    The Protocol is the instructions for how to send a query to 
    the triple store, and how the triple store should send you back the results.
    </p>
</details>
</section>

<section>
  <h4>Protocol:</h4>
  <p>How you send the queries and what you get back.</p>
</section> 

<section>
  <h4>SPARQL uses the language of the Web</h4>
  <figure>
    <img alt="http" src="images/http.jpg">
  </figure>

</section>
<section>
<h4>HTTP</h4>
  <p>
  With HTTP, URIs are nouns, naming resources.
  you send a request to those URIs along with a verb:
  </p>
  <ul>
    <li>GET</li>
    <li>POST</li>
    <li>DELETE</li>
    <li>PUT</li>
  </ul>
</section>

<section>
  <figure>
    <img alt="the client sends the query to the SPARQL Endpoint, an interface to the triple store" src="images/sparqlserverclient.png">
  </figure>
  </section>

  <section>
  <h5>You have the URI of the SPARQL Endpoint</h5> 
  <code>
    http://example.info/sparql
  </code>
  </section>

  <section>
  <h5>You have a query</h5> 
  <code>
    DESCRIBE ?book {
      ?book a schema:Book ;
        schema:author &lt;http://dbpedia.org/resource/William_Shakespeare&gt;
    }
  </code>
  </section>

  <section>
  <code>
    http://example.info/sparql<strong>?query=</strong>
  </code>

  </section>


<section>
  <h3>Query Request</h3>
  <p><em><code>GET</code></em> 
  <code>http://example.info/sparql?query={urlencoded query}</code></p>
</section>

<section>
  <h3>Query Results</h3>
  <ul>
    <li>Table
    <li>True or False
    <li>RDF
    </ul>
</section> 

<section>
  <h4>Strengths of SPARQL information retrieval</h4>
  <ul>
    <li> Powerful query language
    <li> Can specify exactly the things you are interested in
    <li> Can pull back only the data you need
  </ul>
  <details> </details>
</section>




<section>
  <h4>SPARQL: Limitations &amp; Challenges</h4>
  <ul>
    <li> How do you find SPARQL endpoints to query?
    <li> How do you know what to query for?
    <li> Querying multiple datasets at once
    <li> Free text search
  </ul>
</section>

<section>
  <h4>Describing Datasets: Vocabulary of Interlinked Datasets </h4>
  <ul>
    <li>SPARQL endpoint
    <li>Topics 
    <li>License
    <li>Vocabularies used (and classes and properties)
    <li>Examples of things in the dataset
    <li>Links to other datasets
    <li>Statistics
  </ul>
  <details> </details>
</section>

<section>
  <h3>Finding dataset metadata with VoID </h3>
  <p>from an rdf web page:</p>
  <pre><code>
  &lt;/books/1.rdf&gt; void:inDataset &lt;/dataset&gt; .
  </code>
  </pre>
  <details> </details>
</section>


<section>
<h2> Thanks </h2>
  <p>Made with <a href="https://github.com/paulrouget/dzslides">DZSlides</a> by Paul Rouget</p>
  <p>Licensed under<br><a href="https://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0 Unported License</a></p>
  
<footer>
    Keith Alexander <br>
    <small>
      Twitter: @keithalexander <br>
      keithalexander@keithalexander.co.uk <br>
    </small>
</footer>
</section>

<section>
    <h3>An incremental list</h3>
    <ul class="incremental">
      <li>Item 1
      <li>Item 2
      <li>Item 3
    </ul>
    <details>Some notes. They are only visible using onstage shell.</details>
</section>

<section>
  <blockquote>
    Who's brave enough to fly into something we all keep calling a death sphere?
  </blockquote>
</section>

<section>
    <h2>Part two</h2>
</section>

<section>
    <figure> <!-- Figures are used to display images and videos fullpage -->
      <img src="http://placekitten.com/g/800/600">
      <figcaption>An image</figcaption>
    </figure>
    <details>Kittens are so cute!</details>
</section>

<section>
    <figure> <!-- Videos are automatically played -->
      <video src="http://videos-cdn.mozilla.net/brand/Mozilla_Firefox_Manifesto_v0.2_640.webm" poster="http://www.mozilla.org/images/about/poster.jpg"></video>
      <figcaption>A video</figcaption>
    </figure>
</section>

<section>
    <h2>End!</h2>
</section>

<!-- Your Style -->
<!-- Define the style of your presentation -->

<!-- Maybe a font from http://www.google.com/webfonts ? -->
<link href='http://fonts.googleapis.com/css?family=Oswald' rel='stylesheet'>

<style>
  html, .view body { background-color: black; counter-reset: slideidx; }
  body, .view section { background-color: white; border-radius: 12px }
  /* A section is a slide. It's size is 800x600, and this will never change */
  section, .view head > title {
      /* The font from Google */
      font-family: 'Oswald', arial, serif;
      font-size: 30px;
  }

  .view section:after {
    counter-increment: slideidx;
    content: counter(slideidx, decimal-leading-zero);
    position: absolute; bottom: -80px; right: 100px;
    color: white;
  }

  .view head > title {
    color: white;
    text-align: center;
    margin: 1em 0 1em 0;
  }

  h1, h2 {
    margin-top: 200px;
    text-align: center;
    font-size: 80px;
  }
  h3 {
    margin: 100px 0 50px 100px;
  }

  ul, ol {
      margin: 50px 200px;
  }


  p {
    margin: 75px;
    font-size: 50px;
  }

  dl {
    margin: 50px;
  }

  dt {
    font-weight: bold;
  }

  blockquote {
    height: 100%;
    background-color: black;
    color: white;
    font-size: 60px;
    padding: 50px;
  }
  blockquote:before {
    content: open-quote;
  }
  blockquote:after {
    content: close-quote;
  }

  /* Figures are displayed full-page, with the caption
     on top of the image/video */
  figure {
    background-color: black;
    width: 100%;
    height: 100%;
  }
  figure > * {
    position: absolute;
  }
  figure > img, figure > video {
    width: 100%; height: 100%;
  }
  figcaption {
    margin: 70px;
    font-size: 50px;
  }

  footer {
    position: absolute;
    bottom: 0;
    width: 100%;
    padding: 40px;
    text-align: right;
    background-color: #F3F4F8;
    border-top: 1px solid #CCC;
  }

  /* Transition effect */
  /* Feel free to change the transition effect for original
     animations. See here:
     https://developer.mozilla.org/en/CSS/CSS_transitions
     How to use CSS3 Transitions: */
  section {
    -moz-transition: left 400ms linear 0s;
    -webkit-transition: left 400ms linear 0s;
    -ms-transition: left 400ms linear 0s;
    transition: left 400ms linear 0s;
  }
  .view section {
    -moz-transition: none;
    -webkit-transition: none;
    -ms-transition: none;
    transition: none;
  }

  .view section[aria-selected] {
    border: 5px red solid;
  }

  /* Before */
  section { left: -150%; }
  /* Now */
  section[aria-selected] { left: 0; }
  /* After */
  section[aria-selected] ~ section { left: +150%; }

  /* Incremental elements */

  /* By default, visible */
  .incremental > * { opacity: 1; }

  /* The current item */
  .incremental > *[aria-selected] { opacity: 1; }

  /* The items to-be-selected */
  .incremental > *[aria-selected] ~ * { opacity: 0; }

  /* The progressbar, at the bottom of the slides, show the global
     progress of the presentation. */
  #progress-bar {
    height: 2px;
    background: #AAA;
  }
</style>

<!-- {{{{ dzslides core
#
#
#     __  __  __       .  __   ___  __
#    |  \  / /__` |    | |  \ |__  /__`
#    |__/ /_ .__/ |___ | |__/ |___ .__/ core :â¬
#
#
# The following block of code is not supposed to be edited.
# But if you want to change the behavior of these slides,
# feel free to hack it!
#
-->

<div id="progress-bar"></div>

<!-- Default Style -->
<style>
  * { margin: 0; padding: 0; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }
  details { display: none; }
  body {
    width: 800px; height: 600px;
    margin-left: -400px; margin-top: -300px;
    position: absolute; top: 50%; left: 50%;
    overflow: hidden;
    display: none;
  }
  .view body {
    position: static;
    margin: 0; padding: 0;
    width: 100%; height: 100%;
    display: inline-block;
    overflow: visible; overflow-x: hidden;
    /* undo Dz.onresize */
    transform: none !important;
    -moz-transform: none !important;
    -webkit-transform: none !important;
    -o-transform: none !important;
    -ms-transform: none !important;
  }
  .view head, .view head > title { display: block }
  section {
    position: absolute;
    pointer-events: none;
    width: 100%; height: 100%;
  }
  .view section {
    pointer-events: auto;
    position: static;
    width: 800px; height: 600px;
    margin: -150px -200px;
    float: left;

    transform: scale(.4);
    -moz-transform: scale(.4);
    -webkit-transform: scale(.4);
    -o-transform: scale(.4);
    -ms-transform: scale(.4);
  }
  .view section > * { pointer-events: none; }
  section[aria-selected] { pointer-events: auto; }
  html { overflow: hidden; }
  html.view { overflow: visible; }
  body.loaded { display: block; }
  .incremental {visibility: hidden; }
  .incremental[active] {visibility: visible; }
  #progress-bar{
    bottom: 0;
    position: absolute;
    -moz-transition: width 400ms linear 0s;
    -webkit-transition: width 400ms linear 0s;
    -ms-transition: width 400ms linear 0s;
    transition: width 400ms linear 0s;
  }
  .view #progress-bar {
    display: none;
  }
</style>

<script>
  var Dz = {
    remoteWindows: [],
    idx: -1,
    step: 0,
    html: null,
    slides: null,
    progressBar : null,
    params: {
      autoplay: "1"
    }
  };

  Dz.init = function() {
    document.body.className = "loaded";
    this.slides = Array.prototype.slice.call($$("body > section"));
    this.progressBar = $("#progress-bar");
    this.html = document.body.parentNode;
    this.setupParams();
    this.onhashchange();
    this.setupTouchEvents();
    this.onresize();
    this.setupView();
  }

  Dz.setupParams = function() {
    var p = window.location.search.substr(1).split('&');
    p.forEach(function(e, i, a) {
      var keyVal = e.split('=');
      Dz.params[keyVal[0]] = decodeURIComponent(keyVal[1]);
    });
  // Specific params handling
    if (!+this.params.autoplay)
      $$.forEach($$("video"), function(v){ v.controls = true });
  }

  Dz.onkeydown = function(aEvent) {
    // Don't intercept keyboard shortcuts
    if (aEvent.altKey
      || aEvent.ctrlKey
      || aEvent.metaKey
      || aEvent.shiftKey) {
      return;
    }
    if ( aEvent.keyCode == 37 // left arrow
      || aEvent.keyCode == 38 // up arrow
      || aEvent.keyCode == 33 // page up
    ) {
      aEvent.preventDefault();
      this.back();
    }
    if ( aEvent.keyCode == 39 // right arrow
      || aEvent.keyCode == 40 // down arrow
      || aEvent.keyCode == 34 // page down
    ) {
      aEvent.preventDefault();
      this.forward();
    }
    if (aEvent.keyCode == 35) { // end
      aEvent.preventDefault();
      this.goEnd();
    }
    if (aEvent.keyCode == 36) { // home
      aEvent.preventDefault();
      this.goStart();
    }
    if (aEvent.keyCode == 32) { // space
      aEvent.preventDefault();
      this.toggleContent();
    }
    if (aEvent.keyCode == 70) { // f
      aEvent.preventDefault();
      this.goFullscreen();
    }
    if (aEvent.keyCode == 79) { // o
      aEvent.preventDefault();
      this.toggleView();
    }
  }

  /* Touch Events */

  Dz.setupTouchEvents = function() {
    var orgX, newX;
    var tracking = false;

    var db = document.body;
    db.addEventListener("touchstart", start.bind(this), false);
    db.addEventListener("touchmove", move.bind(this), false);

    function start(aEvent) {
      aEvent.preventDefault();
      tracking = true;
      orgX = aEvent.changedTouches[0].pageX;
    }

    function move(aEvent) {
      if (!tracking) return;
      newX = aEvent.changedTouches[0].pageX;
      if (orgX - newX > 100) {
        tracking = false;
        this.forward();
      } else {
        if (orgX - newX < -100) {
          tracking = false;
          this.back();
        }
      }
    }
  }

  Dz.setupView = function() {
    document.body.addEventListener("click", function ( e ) {
      if (!Dz.html.classList.contains("view")) return;
      if (!e.target || e.target.nodeName != "SECTION") return;

      Dz.html.classList.remove("view");
      Dz.setCursor(Dz.slides.indexOf(e.target) + 1);
    }, false);
  }

  /* Adapt the size of the slides to the window */

  Dz.onresize = function() {
    var db = document.body;
    var sx = db.clientWidth / window.innerWidth;
    var sy = db.clientHeight / window.innerHeight;
    var transform = "scale(" + (1/Math.max(sx, sy)) + ")";

    db.style.MozTransform = transform;
    db.style.WebkitTransform = transform;
    db.style.OTransform = transform;
    db.style.msTransform = transform;
    db.style.transform = transform;
  }


  Dz.getDetails = function(aIdx) {
    var s = $("section:nth-of-type(" + aIdx + ")");
    var d = s.$("details");
    return d ? d.innerHTML : "";
  }

  Dz.onmessage = function(aEvent) {
    var argv = aEvent.data.split(" "), argc = argv.length;
    argv.forEach(function(e, i, a) { a[i] = decodeURIComponent(e) });
    var win = aEvent.source;
    if (argv[0] === "REGISTER" && argc === 1) {
      this.remoteWindows.push(win);
      this.postMsg(win, "REGISTERED", document.title, this.slides.length);
      this.postMsg(win, "CURSOR", this.idx + "." + this.step);
      return;
    }
    if (argv[0] === "BACK" && argc === 1)
      this.back();
    if (argv[0] === "FORWARD" && argc === 1)
      this.forward();
    if (argv[0] === "START" && argc === 1)
      this.goStart();
    if (argv[0] === "END" && argc === 1)
      this.goEnd();
    if (argv[0] === "TOGGLE_CONTENT" && argc === 1)
      this.toggleContent();
    if (argv[0] === "SET_CURSOR" && argc === 2)
      window.location.hash = "#" + argv[1];
    if (argv[0] === "GET_CURSOR" && argc === 1)
      this.postMsg(win, "CURSOR", this.idx + "." + this.step);
    if (argv[0] === "GET_NOTES" && argc === 1)
      this.postMsg(win, "NOTES", this.getDetails(this.idx));
  }

  Dz.toggleContent = function() {
    // If a Video is present in this new slide, play it.
    // If a Video is present in the previous slide, stop it.
    var s = $("section[aria-selected]");
    if (s) {
      var video = s.$("video");
      if (video) {
        if (video.ended || video.paused) {
          video.play();
        } else {
          video.pause();
        }
      }
    }
  }

  Dz.setCursor = function(aIdx, aStep) {
    // If the user change the slide number in the URL bar, jump
    // to this slide.
    aStep = (aStep != 0 && typeof aStep !== "undefined") ? "." + aStep : ".0";
    window.location.hash = "#" + aIdx + aStep;
  }

  Dz.onhashchange = function() {
    var cursor = window.location.hash.split("#"),
        newidx = 1,
        newstep = 0;
    if (cursor.length == 2) {
      newidx = ~~cursor[1].split(".")[0];
      newstep = ~~cursor[1].split(".")[1];
      if (newstep > Dz.slides[newidx - 1].$$('.incremental > *').length) {
        newstep = 0;
        newidx++;
      }
    }
    this.setProgress(newidx, newstep);
    if (newidx != this.idx) {
      this.setSlide(newidx);
    }
    if (newstep != this.step) {
      this.setIncremental(newstep);
    }
    for (var i = 0; i < this.remoteWindows.length; i++) {
      this.postMsg(this.remoteWindows[i], "CURSOR", this.idx + "." + this.step);
    }
  }

  Dz.back = function() {
    if (this.idx == 1 && this.step == 0) {
      return;
    }
    if (this.step == 0) {
      this.setCursor(this.idx - 1,
                     this.slides[this.idx - 2].$$('.incremental > *').length);
    } else {
      this.setCursor(this.idx, this.step - 1);
    }
  }

  Dz.forward = function() {
    if (this.idx >= this.slides.length &&
        this.step >= this.slides[this.idx - 1].$$('.incremental > *').length) {
        return;
    }
    if (this.step >= this.slides[this.idx - 1].$$('.incremental > *').length) {
      this.setCursor(this.idx + 1, 0);
    } else {
      this.setCursor(this.idx, this.step + 1);
    }
  }

  Dz.goStart = function() {
    this.setCursor(1, 0);
  }

  Dz.goEnd = function() {
    var lastIdx = this.slides.length;
    var lastStep = this.slides[lastIdx - 1].$$('.incremental > *').length;
    this.setCursor(lastIdx, lastStep);
  }

  Dz.toggleView = function() {
    this.html.classList.toggle("view");

    if (this.html.classList.contains("view")) {
      $("section[aria-selected]").scrollIntoView(true);
    }
  }

  Dz.setSlide = function(aIdx) {
    this.idx = aIdx;
    var old = $("section[aria-selected]");
    var next = $("section:nth-of-type("+ this.idx +")");
    if (old) {
      old.removeAttribute("aria-selected");
      var video = old.$("video");
      if (video) {
        video.pause();
      }
    }
    if (next) {
      next.setAttribute("aria-selected", "true");
      if (this.html.classList.contains("view")) {
        next.scrollIntoView();
      }
      var video = next.$("video");
      if (video && !!+this.params.autoplay) {
        video.play();
      }
    } else {
      // That should not happen
      this.idx = -1;
      // console.warn("Slide doesn't exist.");
    }
  }

  Dz.setIncremental = function(aStep) {
    this.step = aStep;
    var old = this.slides[this.idx - 1].$('.incremental > *[aria-selected]');
    if (old) {
      old.removeAttribute('aria-selected');
    }
    var incrementals = $$('.incremental');
    if (this.step <= 0) {
      $$.forEach(incrementals, function(aNode) {
        aNode.removeAttribute('active');
      });
      return;
    }
    var next = this.slides[this.idx - 1].$$('.incremental > *')[this.step - 1];
    if (next) {
      next.setAttribute('aria-selected', true);
      next.parentNode.setAttribute('active', true);
      var found = false;
      $$.forEach(incrementals, function(aNode) {
        if (aNode != next.parentNode)
          if (found)
            aNode.removeAttribute('active');
          else
            aNode.setAttribute('active', true);
        else
          found = true;
      });
    } else {
      setCursor(this.idx, 0);
    }
    return next;
  }

  Dz.goFullscreen = function() {
    var html = $('html'),
        requestFullscreen = html.requestFullscreen || html.requestFullScreen || html.mozRequestFullScreen || html.webkitRequestFullScreen;
    if (requestFullscreen) {
      requestFullscreen.apply(html);
    }
  }
  
  Dz.setProgress = function(aIdx, aStep) {
    var slide = $("section:nth-of-type("+ aIdx +")");
    if (!slide)
      return;
    var steps = slide.$$('.incremental > *').length + 1,
        slideSize = 100 / (this.slides.length - 1),
        stepSize = slideSize / steps;
    this.progressBar.style.width = ((aIdx - 1) * slideSize + aStep * stepSize) + '%';
  }
  
  Dz.postMsg = function(aWin, aMsg) { // [arg0, [arg1...]]
    aMsg = [aMsg];
    for (var i = 2; i < arguments.length; i++)
      aMsg.push(encodeURIComponent(arguments[i]));
    aWin.postMessage(aMsg.join(" "), "*");
  }
  
  function init() {
    Dz.init();
    window.onkeydown = Dz.onkeydown.bind(Dz);
    window.onresize = Dz.onresize.bind(Dz);
    window.onhashchange = Dz.onhashchange.bind(Dz);
    window.onmessage = Dz.onmessage.bind(Dz);
  }

  window.onload = init;
</script>


<script> // Helpers
  if (!Function.prototype.bind) {
    Function.prototype.bind = function (oThis) {

      // closest thing possible to the ECMAScript 5 internal IsCallable
      // function 
      if (typeof this !== "function")
      throw new TypeError(
        "Function.prototype.bind - what is trying to be fBound is not callable"
      );

      var aArgs = Array.prototype.slice.call(arguments, 1),
          fToBind = this,
          fNOP = function () {},
          fBound = function () {
            return fToBind.apply( this instanceof fNOP ? this : oThis || window,
                   aArgs.concat(Array.prototype.slice.call(arguments)));
          };

      fNOP.prototype = this.prototype;
      fBound.prototype = new fNOP();

      return fBound;
    };
  }

  var $ = (HTMLElement.prototype.$ = function(aQuery) {
    return this.querySelector(aQuery);
  }).bind(document);

  var $$ = (HTMLElement.prototype.$$ = function(aQuery) {
    return this.querySelectorAll(aQuery);
  }).bind(document);

  $$.forEach = function(nodeList, fun) {
    Array.prototype.forEach.call(nodeList, fun);
  }

</script>
<!-- vim: set fdm=marker: }}} -->
